# Typescript OAuth2 Server

[![Tests](https://github.com/jasonraimondi/typescript-oauth2-server/workflows/Tests/badge.svg)](https://github.com/jasonraimondi/typescript-oauth2-server/actions?query=workflow%3A%22Tests%22)

## Which Grant?

```
+-------+
| start |
+-------+
    V
    |
    |
+---------------------+                +--------------------------+
| Access token owner? |>---Machine---->| Client Credentials Grant |
+---------------------+                +--------------------------+
    V
    |
   User
    |
    |                          +---------------------------+
    |>----Server App---------->| Auth Code Grant with PKCE |
    |                          +---------------------------+
    |
    |                          +---------------------------+
    |>----Browser Based App--->| Auth Code Grant with PKCE |
    |                          +---------------------------+
    |
    |                          +---------------------------+
    |>----Native Mobile App--->| Auth Code Grant with PKCE |
                               +---------------------------+

```

## Client Credentials Grant

https://tools.ietf.org/html/rfc6749#section-4.4

https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/

```http request
POST /token HTTP/1.1
Host: example.com
 
grant_type=client_credentials
&client_id=xxxxxxxxxx
&client_secret=xxxxxxxxxx
```

Token Response:

https://www.oauth.com/oauth2-servers/access-tokens/access-token-response/

```http request
HTTP/1.1 200 OK
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache
 
{
  "access_token":"MTQ0NjJkZmQ5OTM2NDE1ZTZjNGZmZjI3",
  "token_type":"bearer",
  "expires_in":3600,
  "refresh_token":"IwOGYzYTlmM2YxOTQ5MGE3YmNmMDFkNTVk",
  "scope":"create"
}
```

## @TODO Appropriate Unsuccessful Response

https://www.oauth.com/oauth2-servers/access-tokens/access-token-response/


## Authorization Code Grant with PKCE


https://tools.ietf.org/html/rfc6749#section-4.1 
https://tools.ietf.org/html/rfc7636

https://www.oauth.com/oauth2-servers/pkce/

read this https://www.oauth.com/oauth2-servers/pkce/authorization-request/

- **response_type=code** – indicates that your server expects to receive an authorization code
- **client_id=** – The client ID you received when you first created the application
- **redirect_uri=** – Indicates the URL to return the user to after authorization is complete, such as org.example.app://redirect
- **state=1234zyx** – A random string generated by your application, which you’ll verify later
- **code_challenge=XXXXXXXXX** – The code challenge generated as previously described
- **code_challenge_method=S256** – either plain or S256, depending on whether the challenge is the plain verifier string or the SHA256 hash of the string. If this parameter is omitted, the server will assume plain.

```typescript
const code_verifier = base64urlencode(crypto.randomBytes(40));
const code_challenge = base64urlencode(crypto.createHash("sha256").update(codeVerifier).digest("hex"));
```

```http request
GET /authorize HTTP/1.1
Host: example.com
 
id=123
&response_type=code
&client_id=xxxxxxx
&redirect_uri=http://localhost
&scope=xxxx
&state=xxxx
&code_challenge=xxxx
&code_challenge_method=s256
```